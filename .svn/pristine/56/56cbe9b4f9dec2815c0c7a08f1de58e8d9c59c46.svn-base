
//保存所有表格的列设置，页面只需要传入当前表格的名字
var colsData=[];
//管理员列表
colsData['admin-admin-index']=[[
    {type: "checkbox", fixed:"left", width:50},
    {field: 'username', title: '用户名', width:100, align:"center"},
    {field: 'role_name', title: '角色',minWidth:250,align:'left'},
    {field: 'email', title: '邮箱', minWidth:200, align:'center',templet:function(d){
        return '<a class="layui-blue" href="mailto:'+d.email+'">'+d.email+'</a>';
    }},
    {field: 'login_total', title: '登录次数', align:'center'},
    {field: 'login_time', title: '最后登录时间', width:150,align:'center',templet:function(d){
        return formatTimestamp(d.login_time);
    }},
    {field: 'state', title: '状态', align:'center',templet:function(d){
        if(d.id!=1)
        {
            var checked=d.state==1?"checked":"";
        return '<input type="checkbox" name="state" lay-filter="admin-index-state" data-id='+d.id+' lay-skin="switch" lay-text="启用|禁用 "'+checked+'>';
        }
        return "";
    }},
    {title: '操作', minWidth:175, templet:'#userListBar',align:"center"}
]];
//文章列表
colsData['admin-article-articlelist']=[[
    {type:'numbers',title: '序号', width:70, align:"center"},
    {field:'id',title: 'ID', width:70, align:"center"},
    {field: 'title', title: '文章标题', minWidth:200,align:"center",templet:function(d){
          if(d.title_color!=="")
          {
              return "<a href='preview/id/"+d.id+"' target='_blank'><font color="+d.title_color+">"+d.title+"</font></a>";
          }
          return "<a href='preview/id/"+d.id+"' target='_blank'>"+d.title+"</a>";
    }},
    {field:'category',title: '分类', width:100, align:"center"},
    {field: 'author', title: '发布者',minWidth:100,align:'center'},
    {title: '缩略图', minWidth:200, align:'center',templet:function(d){
          if(d.src!==null)
          {
              var html = '<div class="layer-photos">';
              html += '<img layer-src="'+d.src+'" src="'+d.src+'" alt="'+d.id+'"></div>';         
              return html;
          }
          return "";
    }},
    {field: 'describe', title: '描述', minWidth:150,align:'center'},
    {field: 'position', title: '工作地点', minWidth:100,align:'center'},
    {field: 'work_number', title: '招聘人数', minWidth:100,align:'center'},
    {field: 'education', title: '学历要求', minWidth:100,align:'center'},
    {field: 'access_count', title: '访问次数', align:'center'},
    {field: 'state', title: '状态', align:'center',templet:function(d){
          var checked=d.state==1?"checked":"";
          return '<input type="checkbox" name="state" lay-filter="admin-articel-state" data-id='+d.id+' lay-skin="switch" lay-text="启用|禁用 "'+checked+'>';
    }},
    {title: '添加时间', width:150,align:'center',templet:function(d){
          return formatTimestamp(d.add_time);
    }},
    {title: '更改时间', width:150,align:'center',templet:function(d){
          if(d.update_time!==0)
          {
              return formatTimestamp(d.update_time);
          }
          return "";
    }},
    {title: '操作', minWidth:175, templet:'#userListBar',align:"center",fixed:"right"}
]]
//文章分类列表
colsData['admin-articel-articlecategory']=[[
    {title: '序号', type:'numbers',width:50, align:"center"},
    {field: 'name', title: '分类名',minWidth:150,align:'left'},
    {field: 'column_name', title: '所属栏目',width:150,align:'center'},
    {field: 'sort', title: '排序',width:80,align:'center'},
    {field: 'location', title: '跳转分类',width:250,align:'left'},
    {title: '操作', width:175, templet:'#categoryListBar',align:"center",field:"right"}
]];
//链接管理
colsData['admin-config-link']=[[
    {type:'numbers',title: '序号', width:70, align:"center"},
    {title: 'LOGO', minWidth:150, align:'center',templet:function(d){
          if(d.src!==null)
          {
             var html = '<div class="layer-photos">';
              html += '<img layer-src="'+d.src+'" src="'+d.src+'" alt="'+d.id+'"></div>';         
              return html;
          }
          return "";
    }},
    {field: 'link_name', title: '网站名称', minWidth:200,align:"center"},
    {field: 'type', title: '分组', Width:100,align:"center"},
    {field: 'sort', title: '排序', Width:50,align:"center"},
    {field: 'url', title: '网站地址',minWidth:300,align:'center'},
    {field: 'icon', title: 'icon类名', minWidth:200,align:"center"},
    {title: '新页面', align:'center',templet:function(d){
      if(d.id==1){
        return "是";
      }
      return "否"; 
    }},
    {field: 'state', title: '状态', align:'center',templet:function(d){
          var checked=d.state==1?"checked":"";
           return '<input type="checkbox" name="state" lay-filter="admin-link-state" data-id='+d.id+' lay-skin="switch" lay-text="启用|禁用 "'+checked+'>';
    }},
    {field: 'describe', title: '描述', minWidth:200,align:'center'},
    {title: '添加时间', width:150,align:'center',templet:function(d){
          return formatTimestamp(d.add_time);
    }},
    {title: '更改时间', width:150,align:'center',templet:function(d){
          if(d.update_time!==0)
          {
              return formatTimestamp(d.update_time);
          }   
          return "";
    }},
    {title: '操作', minWidth:175, templet:'#bar',align:"center",fixed:"right"}
]];
//日志管理
colsData['admin-log-index']=[[
    {type:'numbers',title: '序号', width:70, align:"center"},
    {field:'username',title: '用户名', width:100, align:"center"},
    {field: 'info', title: '信息',minWidth:250,align:'center'},
    {field: 'get', title: '操作URL', minWidth:350,align:'center'},
    {title: '时间', align:'center',width:150,templet:function(d){
        return formatTimestamp(d.add_time);
    }},
    {field: 'ip', title: 'IP', width:160,align:'center'},
    {title: '状态', width:150,align:'center',templet:function(d){
        if(d.code==1)
        {
            return "<span style='color:#3c763d;'>成功</span>";
        }else{
            return "<span style='color:#a94442;'>失败</span>";
        } 
    }}
]];
//角色列表
colsData['admin-role-index']=[[
    {field: 'name', title: '角色名', align:'center'},
    {field: 'role_des', title: '描述', align:'center'},
    {field: 'add_time', title: '添加时间',align:'center',templet:function(d){
        return formatTimestamp(d.add_time);
    }},
  {title: '操作', minWidth:175, templet:'#roleListBar',fixed:"right",align:"center"}
]];
//栏目列表
colsData['admin-config-column']=[[
    {field: 'name', title: '栏目名称',minWidth:250,templet:function(d){
        var str="";
        for(var i=0;i<d.level;i++){
           str+="&nbsp;&nbsp;&nbsp;";
        }
        if(d.level==0)
        {
          return d.name
        }
        return str+"└─"+d.name;
    }},
    {field: 'control', title: '控制器', align:'center'},
    {field: 'action', title: '方法', align:'center'},
    {field: 'sort', title: '排序', align:'center',width:80},
    {title: '新页面', align:'center',width:100,templet:function(d){
        if(d.is_new==1){
          return "是";
        }
        return "否"; 
    }},
    {field: 'state', title: '状态', align:'center',templet:function(d){
        var checked=d.state==1?"checked":"";
        return '<input type="checkbox" name="state" lay-filter="admin-column-state" data-id='+d.id+' lay-skin="switch" lay-text="启用|禁用 "'+checked+'>';
    }},
    {title: '添加时间',align:'center',width:150,templet:function(d){
        return formatTimestamp(d.add_time);
    }},
  {title: '操作', minWidth:175, templet:'#columnListBar',fixed:"right",align:"center"}
]];
//轮播图管理
colsData['admin-config-slide']=[[
    {type:'numbers',title: '序号', width:70, align:"center"},
    {field: 'name', title: '名称', width:170,align:"center"},
    {field: 'type', title: '分组', width:100,align:"center"},
    {title: '轮播图片', minWidth:200, align:'center',templet:function(d){
          if(d.src!==null)
          {
            var html = '<div class="layer-photos">';
              html += '<img layer-src="'+d.src+'" src="'+d.src+'" alt="'+d.id+'"></div>';         
              return html;
          }
          return "";
    }},
    {field: 'event_type', title: '事件类型', minWidth:100,align:"center"},
    {field: 'event_value', title: '事件值',minWidth:300,align:'center'},
    {field: 'state', title: '状态', align:'center',templet:function(d){
          var checked=d.state==1?"checked":"";
           return '<input type="checkbox" name="state" lay-filter="admin-slide-state" data-id='+d.id+' lay-skin="switch" lay-text="启用|禁用 "'+checked+'>';
    }},
    {field: 'sort', title: '排序', Width:50,align:"center"},
    {field: 'describe', title: '描述', align:'center',minWidth:200},
    {title: '添加时间', width:150,align:'center',templet:function(d){
          return formatTimestamp(d.add_time);
    }},
    {title: '更改时间', width:150,align:'center',templet:function(d){
          if(d.update_time!==0)
          {
              return formatTimestamp(d.update_time);
          }
          return "";
    }},
    {title: '操作', minWidth:175, templet:'#bar',align:"center",fixed:"right"}
]];

//下载地址管理
colsData['admin-config-download']=[[
    {type:'numbers',title: '序号', width:70, align:"center"},
    {title: 'LOGO', minWidth:150, align:'center',templet:function(d){
          if(d.src!==null)
          {
            var html = '<div class="layer-photos">';
            html += '<img layer-src="'+d.src+'" src="'+d.src+'" alt="'+d.id+'"></div>';         
            return html;
          }
          return "";
    }},
    {field: 'download_name', title: '名称', minWidth:200,align:"center"},
    {field: 'sort', title: '排序', Width:50,align:"center"},
    {title: '文件',width:200 ,align:'center',templet:function(d){
          if(d.real_name!==null)
          {
              return "<a href='"+d.down_src+"'>"+d.real_name+"</a>";
          }
          return "";
    }},
    {field: 'type', title: '分组', Width:100,align:"center"},
    {field: 'describe', title: '描述', minWidth:200,align:'center'},
    {field: 'location', title: '跳转链接',minWidth:300,align:'center'},
    {field: 'state', title: '状态', align:'center',templet:function(d){
          var checked=d.state==1?"checked":"";
           return '<input type="checkbox" name="state" lay-filter="admin-download-state" data-id='+d.id+' lay-skin="switch" lay-text="启用|禁用 "'+checked+'>';
    }},
    {title: '添加时间', width:150,align:'center',templet:function(d){
          return formatTimestamp(d.add_time);
    }},
    {title: '更改时间', width:150,align:'center',templet:function(d){
          if(d.update_time!==0)
          {
              return formatTimestamp(d.update_time);
          }
          return "";
    }},
    {title: '操作', minWidth:175, templet:'#bar',align:"center",fixed:"right"}
]];
//信息列表页
colsData['admin-article-infolist']=[[
    {title: '序号', type:'numbers',width:50, align:"center"},
    {field: 'name',title: '姓名',width:150, align:"center"},
    {field: 'wx', title: '微信号',width:150,align:'left'},
    {field: 'sheng', title: '省份',width:80,align:'left'},
    {field: 'city', title: '城市',width:80,align:'left'},
    {field: 'mobile', title: '电话',width:200,align:'left'},
    {title:'日期',width:200,align:'left',templet:function(d){
          if(d.add_time!==0)
          {
              return formatTimestamp(d.add_time);
          }
          return "";
    }},
    {field: 'describe', title: '留言',width:250,align:'left'},
    {title: '操作', width:175, templet:'#bar',align:"center",fixed:"right"}
]];

function formatTimestamp($timestamp){
  if($timestamp)
  {
     var date=new Date(parseInt($timestamp)*1000);
     return date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate()+' '+date.getHours()+":"+date.getMinutes();
  }else{
     return "";
  }
}
function formatNumber(n) {
  n = n.toString()
  return n[1] ? n : '0' + n
}

/*
* 表格操作
* 调用至少需要传入
* elem       //table的id
* url       //请求地址
* colsName  //表格配置cols的名字
*/
layui.define(["table"],function(exports){
	var table=layui.table;
  var Tab=function(option){
      this.c={};
      //layui的配置
      this.c.table = {
          cellMinWidth : 95,
          height : "full-125",
          page : true,
          limits : [20,40,60,80,100],
          limit : 20,
      }
  };

  //合并默认配置生成表格，返回表格的layui对象
  Tab.prototype.init=function(option,callback){
    var _this=this;
    $.extend(true,_this.c,option);
    //加入表单的cols
    _this.c.table.cols=colsData[_this.c.colsName];
    //初始化表格
    var tableIns = table.render(_this.c.table);
    //调用回调,传入当前table的layui对象
    callback(tableIns);
  }

  /**
   * 数据表格中编辑
   */
  Tab.prototype.edit = function(option){
    var c = {
      primary:"id", //主键字段
    }
    $.extend(true,c,option);
    table.on("edit("+c.filter+")",function(obj){
        var k = obj.field,
        primary = c.primary,
        d = {};
        d[primary] = obj.data[primary];
        d[k] = obj.value;
        $.ajax({
          type: "post",
          url: c.url?c.url:"#",
          data: d,
          dataType :'json',
          success: function(res){
            if(res.code==1)
            {
                layer.msg(res.message, {
                  icon: 1,
                  time: 1000
                });     
            }else{
                layer.alert(res.message, {icon: 5});
            }
          },
          error:function(){
            layer.alert("服务器异常,请稍后重试",{icon: 5});
          }
        }) 
    })
  }


  var tableOp=new Tab();
	exports("tableOp",tableOp);
})
